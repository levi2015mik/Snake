<!DOCTYPE html>
<html>
<head>
	<title>Snake</title>
	<style type="text/css">
		.field{
			border:dotted 3px #cccccc;
			width: 400px;
			line-height: 0;
		}
		.exel{
			width: 20px;
			height: 20px;
			box-sizing: border-box;
			border: solid 1px #000;
			display: inline-block;
		}
		.exel.snake{
			background-color: #0F0;
		}

	</style>
</head>
<body>
	<div class="field"></div>

</body>
<script type="text/javascript">
	const EMPTY = 0
	const TAIL  = 1
	const HEAD  = 2
	const MOUSE = 3
	const WALL  = 4

	class Exel{
		constructor(x,y){
			this.element = document.createElement("div")
			this.element.className = "exel"
			this.x = x;
			this.y = y;
			this._state = EMPTY;
			this.turn = 0
			this.modX = 1
			this.modY = 0
		}
		set state(state){			
			this._state = state;
			switch(state){
				case EMPTY: this.element.classList.remove("snake"); break;
				case TAIL: this.element.classList.add("snake");break;
				case HEAD: this.element.classList.add("snake"); break;
				case MOUSE: break;
				case WALL: break;
			}

		}
	}

	class Snake{
		constructor(len){
			this.x = getRandomArbitrary(len,19)
			this.y = getRandomArbitrary(0,19)
			this.len = len;
			this.modX = 1;
			this.modY = 0;
			this.elements = []
			let ceils = 0
			while(len){
				len --;
				let x = this.x - ceils
				this.elements.push(Exel.matrix[this.y][x])
				this.elements[ceils].state = TAIL
				ceils ++
			}
			this.elements[0].state = HEAD
		}

		step(){
			for (var i = 0; i < this.elements.length; i++) {

				if(this.elements[i].turn === 1){
					console.log(this.elements[i].modX,this.elements[i].modY," pre")
					if(this.elements[i].modX === 1 && this.elements[i].modY === 0){
						this.elements[i].modX = 0
						this.elements[i].modY = 1
					} else
					if(this.elements[i].modX === 0 && this.elements[i].modY === 1){
						this.elements[i].modX = -1
						this.elements[i].modY = 0

					} else
					if(this.elements[i].modX === -1 && this.elements[i].modY === 0){
						this.elements[i].modX = 0
						this.elements[i].modY = -1

					} else
					if(this.elements[i].modX === 0 && this.elements[i].modY === -1){
						this.elements[i].modX = 1
						this.elements[i].modY = 0

					}
					console.log(this.elements[i].modX,this.elements[i].modY," post")

				}
				if(this.elements[i].turn === -1){
					if(this.elements[i].modX === 1 && this.elements[i].modY === 0){
						this.elements[i].modX = 0
						this.elements[i].modY = -1
					} else
					if(this.elements[i].modX === 0 && this.elements[i].modY === -1){
						this.elements[i].modX = -1
						this.elements[i].modY = 0
					} else
					if(this.elements[i].modX === -1 && this.elements[i].modY === 0){
						this.elements[i].modX = 0
						this.elements[i].modY = 1
					} else
					if(this.elements[i].modX === 0 && this.elements[i].modY === 1){
						this.elements[i].modX = 1
						this.elements[i].modY = 0
					}

				}

				let modX = this.elements[i].modX;
				let modY = this.elements[i].modY;


				if(i === 0){
					this.x += this.elements[i].modX;
					if(this.x > 19) this.x = 0
					if(this.x < 0 ) this.x = 19
					this.y += this.elements[i].modY;
					if(this.y > 19) this.y = 0
					if(this.y < 0 ) this.y = 19
					this.colisionTest(this.x,this.y)	
				}

				let x = this.elements[i].x + modX
				if(x > 19) x = 0
				if(x < 0 ) x = 19

				let y = this.elements[i].y + modY
				if(y > 19) y = 0
				if(y < 0 ) y = 19

				this.elements[i].state = EMPTY
				if(i === this.elements.length -1) this.elements[i].turn = 0;
				this.elements[i] = Exel.matrix[y][x]
				this.elements[i].modX = modX;
				this.elements[i].modY = modY;
				this.elements[i].state = i === 0? HEAD: TAIL; 
			}
		}

		colisionTest(x,y){
			for (var i = 0; i < this.elements.length; i++) {
				if(this.elements[i].x === x && this.elements[i].y === y) debugger;
			}
		}
	}


	Exel.matrix = []
	Exel.createField = function createField(width,height,el){
		let count = width * height
		for (var i = 0; i < count; i++) {
			let x = i % width
			let y = parseInt(i/width)
			let exel = new Exel(x,y)
			el.appendChild(exel.element)
			if(!Exel.matrix[y])Exel.matrix[y] = [];
			Exel.matrix[y][x] = exel;
		}
	}

	var int = setInterval(()=>snake.step(),1000)
	document.addEventListener("keydown",(e)=>{
		if(e.keyCode === 37) snake.elements[0].turn = -1
		if(e.keyCode === 39) snake.elements[0].turn = 1
	})


	function getRandomArbitrary(min, max) {
  		return Math.round(Math.random() * (max - min) + min);
	}

	Exel.createField(20,20,document.querySelector(".field"))
	snake = new Snake(9)
</script>
</html>